<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Document</title>
  </head>
  <body>
    <button id="start_demo" class="btn">Test Your Browser</button>
    <p id="data"></p>
    <script
      type="module"
      src="/static/js/main.js"
      type="text/javascript"
    ></script>
    <script type="module">
      import { get_attributes } from "./static/js/main.js";

      // Fetch attributes from main.js
      // let attributes  = {};
      // attributes = get_attributes();

      // extrach accelerometer data
      let data_point = [];
      let data_display = document.getElementById("data");
      function handleOrientation(event) {
        incrementEventCount();
      }

      function handleMotion(event) {
        data_point.push([
          event.acceleration.x,
          event.acceleration.y,
          event.acceleration.z,
        ]);
      }

      let is_running = false;
      let demo_button = document.getElementById("start_demo");

      demo_button.onclick = function (e) {
        e.preventDefault();

        // Request permission for iOS 13+ devices
        if (
          DeviceMotionEvent &&
          typeof DeviceMotionEvent.requestPermission === "function"
        ) {
          DeviceMotionEvent.requestPermission();
        }

        if (is_running) {
          window.removeEventListener("devicemotion", handleMotion);
          window.removeEventListener("deviceorientation", handleOrientation);
          demo_button.innerHTML = "Start demo";
          // attributes["accelerometer"] = data_point;
          // data_display.innerHTML = JSON.stringify(attributes);
          data_display.innerHTML = JSON.stringify(data_point);

          is_running = false;
        } else {
          window.addEventListener("devicemotion", handleMotion);
          window.addEventListener("deviceorientation", handleOrientation);
          document.getElementById("start_demo").innerHTML = "Stop";
          is_running = true;
          data_point.length = 0;
          data_display.innerHTML = "";
        }
      };
    </script>
  </body>
</html>
